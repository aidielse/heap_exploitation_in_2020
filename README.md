# Heap Exploitation in 2020

1. Introduction
2. ptmalloc2 Heap Overview
3. The Classical Era
   * The Original Poison Null Byte
      * [Bugtraq Mailing List](https://seclists.org/bugtraq/1998/Oct/109), October 1998
      * Widely considered unexploitable, but patched anyway.
   * 'Vudo Malloc Tricks' and 'Once Upon A Free'
      * Unlink and Frontlink Techniques
      * Phrack 57, August 2001
      * Fixed in late 2004
         * People mostly believed that the patch made killed the technique.
         * After a few years, people started exploiting a variant of the technique.
         * Modified version of the Unlink technique would be still be viable.
      * Trend of removing a technique with a patch, only for a variant of it to still be exploitable
   * Advanced Doug Lea's Malloc Exploits
      * Phrack 61, August 2003      
   * Exploiting the Wilderness
      * Bugtraq Mailing List, February 2004    
   * The Malloc Maleficarum
      * Bugtraq Mailing list, October 2005
      * Revised version of House of Lore killed by introduction of tcache, still exploitable if glibc is built with tcache disabled.
      * House of Spirit still exploitable.
      * House of Force finally killed in glibc 2.29 in August 2018
   * The use of 'set_head' to Defeat The Wilderness
      * Phrack 64, May 2007    
   * Yet Another free() Exploitation Technique
      * Phrack 66, November 2009    
   * The Malloc Des-Maleficarum
      * Phrack 66, November 2009
   * The House of Lore: Reloaded
      * Phrack 67, November 2010      

4. The Renaissance: CTFs cause Heap Exploitation to go 'Sicko Mode'

   * Unsafe Unlink, 2014 Edition
      * [HITCON CTF](http://acez.re/ctf-writeup-hitcon-ctf-2014-stkof-or-modern-heap-overflow/), August 2014
      * Killed by introduction of tcache, still exploitable if glibc is built with tcache disabled.
   * Poison NULL byte, 2014 Edition
      * [Google Project Zero](https://googleprojectzero.blogspot.com/2014/08/the-poisoned-nul-byte-2014-edition.html), August 2014
      * Killed by introduction of tcache, still exploitable if glibc is built with tcache disabled.
   * Overlapping Chunks
      * [Glibc Adventures - The Forgotten Chunks](http://tukan.farm/2016/02/25/hacklu-2015-bookstore-writeup/), February, 2015
   * House of Orange
      * [HITCON CTF](http://4ngelboy.blogspot.com/2016/10/hitcon-ctf-qual-2016-house-of-orange.html), October, 2016
      * "The attack vector of this technique was removed by changing the behavior of malloc_printerr in glibc 2.26
  * House of Einherjar
      * [Code Blue Conference](https://www.slideshare.net/codeblue_jp/cb16-matsukuma-en-68459606), November 2016
      * Killed by introduction of tcache, still exploitable if glibc is built with tcache disabled.
   * Unsorted Bin Free Chunk Arbitrary Pointer Leak
      * 0CTF, November 2016
      * Killed by introduction of tcache, still exploitable if glibc is built with tcache disabled.
   * Unsorted Bin Free Chunk Arbitrary Write
      * Couldn't Find Origin
      * tcache introduces additional constraints
   * House of Rabbit
      * [Hatena Blog](http://shift-crops.hatenablog.com/entry/2017/09/17/213235), September 2017
      * Killed by introduction of tcache, still exploitable if glibc is built with tcache disabled.
   * Large Bin Attack
      * [0CTF](https://dangokyo.me/2018/04/07/0ctf-2018-pwn-heapstorm2-write-up/), November 2018
      * Killed by introduction of tcache, still exploitable if glibc is built with tcache disabled.

5. The Dark Age: The Introduction of tcache
   * Introduced in glibc 2.26
      * Killed a lot of techniques, introduced some new avenues for attack.
   * Internals
   * tcache dup
      * Killed in glibc version 2.28
7. Modern Techniques
   * Overlapping Chunks 2: Nonadjacent Free Chunk Consolidation Attack
      * [New Exploit Methods against Ptmalloc of GLIBC](https://loccs.sjtu.edu.cn/wiki/lib/exe/fetch.php?media=gossip:overview:ptmalloc_camera.pdf), 2018
   * fastbin dup
   * fastbin dup into stack
   * fastbin dup consolidate
   * tcache Poisoning
   * tcache House of Spirit
   * House of Botcake
   * House of Fun
      * [PoC || GTFO 18](https://www.alchemistowl.org/pocorgtfo/pocorgtfo18.pdf), 2018
   * House of Roman
      * [DEFCON 26](https://github.com/romanking98/House-Of-Roman), April 2018
8. Archeap Fuzzer
9. Conclusions
10. Works Cited
* [The Malloc Maleficarum](https://seclists.org/bugtraq/2005/Oct/118)
* [Shellphish how2heap](https://github.com/shellphish/how2heap)
* [ptmalloc fanzine](http://tukan.farm/2016/07/26/ptmalloc-fanzine/)
* [Vudo Malloc Tricks (unlink, frontlink)](http://phrack.org/issues/57/8.html)
* [Once Upon A Free](http://www.phrack.org/issues/57/9.html)
